var cryptico=function(){var e={};aes.Init();var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";e.b256to64=function(e){var n,r,i,s="",o=0,u=0,a=e.length;for(i=0;i<a;i++){r=e.charCodeAt(i);if(u==0){s+=t.charAt(r>>2&63);n=(r&3)<<4}else if(u==1){s+=t.charAt(n|r>>4&15);n=(r&15)<<2}else if(u==2){s+=t.charAt(n|r>>6&3);o+=1;s+=t.charAt(r&63)}o+=1;u+=1;u==3&&(u=0)}if(u>0){s+=t.charAt(n);o+=1;s+="=";o+=1}u==1&&(s+="=");return s};e.b64to256=function(e){var n,r,i="",s=0,o=0,u=e.length;for(r=0;r<u;r++){n=t.indexOf(e.charAt(r));if(n>=0){s&&(i+=String.fromCharCode(o|n>>6-s&255));s=s+2&7;o=n<<s&255}}return i};e.b16to64=function(e){var n,r,i="";e.length%2==1&&(e="0"+e);for(n=0;n+3<=e.length;n+=3){r=parseInt(e.substring(n,n+3),16);i+=t.charAt(r>>6)+t.charAt(r&63)}if(n+1==e.length){r=parseInt(e.substring(n,n+1),16);i+=t.charAt(r<<2)}else if(n+2==e.length){r=parseInt(e.substring(n,n+2),16);i+=t.charAt(r>>2)+t.charAt((r&3)<<4)}while((i.length&3)>0)i+="=";return i};e.b64to16=function(e){var n="",r,i=0,s;for(r=0;r<e.length;++r){if(e.charAt(r)=="=")break;v=t.indexOf(e.charAt(r));if(v<0)continue;if(i==0){n+=int2char(v>>2);s=v&3;i=1}else if(i==1){n+=int2char(s<<2|v>>4);s=v&15;i=2}else if(i==2){n+=int2char(s);n+=int2char(v>>2);s=v&3;i=3}else{n+=int2char(s<<2|v>>4);n+=int2char(v&15);i=0}}i==1&&(n+=int2char(s<<2));return n};e.string2bytes=function(e){var t=new Array;for(var n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t};e.bytes2string=function(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t};e.blockXOR=function(e,t){var n=new Array(16);for(var r=0;r<16;r++)n[r]=e[r]^t[r];return n};e.blockIV=function(){var e=new SecureRandom,t=new Array(16);e.nextBytes(t);return t};e.pad16=function(e){var t=e.slice(0),n=(16-e.length%16)%16;for(i=e.length;i<e.length+n;i++)t.push(0);return t};e.depad=function(e){var t=e.slice(0);while(t[t.length-1]==0)t=t.slice(0,t.length-1);return t};e.encryptAESCBC=function(t,n){var r=n.slice(0);aes.ExpandKey(r);var i=e.string2bytes(t);i=e.pad16(i);var s=e.blockIV();for(var o=0;o<i.length/16;o++){var u=i.slice(o*16,o*16+16),a=s.slice(o*16,o*16+16);u=e.blockXOR(a,u);aes.Encrypt(u,r);s=s.concat(u)}var f=e.bytes2string(s);return e.b256to64(f)};e.decryptAESCBC=function(t,n){var r=n.slice(0);aes.ExpandKey(r);var t=e.b64to256(t),i=e.string2bytes(t),s=new Array;for(var o=1;o<i.length/16;o++){var u=i.slice(o*16,o*16+16),a=i.slice((o-1)*16,(o-1)*16+16);aes.Decrypt(u,r);u=e.blockXOR(a,u);s=s.concat(u)}s=e.depad(s);return e.bytes2string(s)};e.wrap60=function(e){var t="";for(var n=0;n<e.length;n++){n%60==0&&n!=0&&(t+="\n");t+=e[n]}return t};e.generateAESKey=function(){var e=new Array(32),t=new SecureRandom;t.nextBytes(e);return e};e.generateRSAKey=function(e,t){Math.seedrandom(sha256.hex(e));var n=new RSAKey;n.generate(t,"03");return n};e.publicKeyString=function(t){pubkey=e.b16to64(t.n.toString(16));return pubkey};e.publicKeyID=function(e){return MD5(e)};e.publicKeyFromString=function(t){var n=e.b64to16(t.split("|")[0]),r="03",i=new RSAKey;i.setPublic(n,r);return i};e.encrypt=function(t,n,r){var i="",s=e.generateAESKey();try{var o=e.publicKeyFromString(n);i+=e.b16to64(o.encrypt(e.bytes2string(s)))+"?"}catch(u){return{status:"Invalid public key"}}if(r){signString=cryptico.b16to64(r.signString(t,"sha256"));t+="::52cee64bb3a38f6403386519a39ac91c::";t+=cryptico.publicKeyString(r);t+="::52cee64bb3a38f6403386519a39ac91c::";t+=signString}i+=e.encryptAESCBC(t,s);return{status:"success",cipher:i}};e.decrypt=function(t,n){var r=t.split("?"),i=n.decrypt(e.b64to16(r[0]));if(i==null)return{status:"failure"};i=e.string2bytes(i);var s=e.decryptAESCBC(r[1],i).split("::52cee64bb3a38f6403386519a39ac91c::");if(s.length==3){var o=e.publicKeyFromString(s[1]),u=e.b64to16(s[2]);return o.verifyString(s[0],u)?{status:"success",plaintext:s[0],signature:"verified",publicKeyString:e.publicKeyString(o)}:{status:"success",plaintext:s[0],signature:"forged",publicKeyString:e.publicKeyString(o)}}return{status:"success",plaintext:s[0],signature:"unsigned"}};return e}();